<!doctype html><html lang=en><head><title>Practical GitOps Pattern</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.663be810443bfefbb9189da05c6ad91f18f642c9bd0ec9f91dd748f00871b9e1.css integrity="sha256-ZjvoEEQ7/vu5GJ2gXGrZHxj2Qsm9Dsn5HddI8AhxueE="><link rel=icon type=image/png href=/images/site/icon.svg><meta property="og:title" content="Practical GitOps Pattern"><meta property="og:description" content="A Practical GitOps Pattern for Kubernetes: Hierarchical Folders, Helm, and Kustomize"><meta property="og:type" content="article"><meta property="og:url" content="/posts/gitops/"><meta property="article:published_time" content="2025-02-25T19:02:12+00:00"><meta property="article:modified_time" content="2025-02-25T19:02:12+00:00"><meta property="article:section" content="posts"><meta name=twitter:card content="summary"><meta name=twitter:title content="Practical GitOps Pattern"><meta name=twitter:description content="A Practical GitOps Pattern for Kubernetes: Hierarchical Folders, Helm, and Kustomize"><meta name=description content="A Practical GitOps Pattern for Kubernetes: Hierarchical Folders, Helm, and Kustomize"><script async src="https://www.googletagmanager.com/gtag/js?id=G-2E1HN9XECT"></script><script>var dnt,doNotTrack=!1;if(null&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2E1HN9XECT")}</script><script integrity="sha256-DO4ugzEwhTW1Id1UIWn0gUJWaebCYOypeTit6LW4QB4=">let theme=localStorage.getItem("theme-scheme")||localStorage.getItem("darkmode:color-scheme")||"light";theme==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/><img src=/images/site/icon.svg id=logo alt=Logo>
Marks Blog</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/#home>Home</a></li><li class=nav-item><a class=nav-link href=/#about>About</a></li><li class=nav-item><a class=nav-link href=/#skills>Skills</a></li><li class=nav-item><a class=nav-link href=/#experiences>Experiences</a></li><li class=nav-item><a class=nav-link href=/#projects>Projects</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>More</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=/#projects>Projects</a>
<a class=dropdown-item href=/#recent-posts>Recent Posts</a></div></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/posts>Posts</a></li><li class=nav-item><a class=nav-link href=/files/cv.pdf>CV</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/icon.svg class=d-none id=main-logo alt=Logo>
<img src=/images/site/icon.svg class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts/ data-filter=all>Posts</a></li><div class=subtree><li><a class=list-link href=/posts/ebpf-bng-infra/ title=ebpf-bng-infra>ebpf-bng-infra</a></li><li><a class=list-link href=/posts/ebpf-bng/ title=ebpf-bng>ebpf-bng</a></li><li><a class="active list-link" href=/posts/gitops/ title=gitops>gitops</a></li><li><a class=list-link href=/posts/socat/ title=socat>socat</a></li><li><a class=list-link href=/posts/gitops-pr-diffs/ title=gitops-pr-diffs>gitops-pr-diffs</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/posts/gitops/hero.jpg)></div><div class=page-content><div class="author-profile ms-auto align-self-lg-center"><img class=rounded-circle src=/images/author/profile_hu_af83896b90796b7f.jpg alt="Author Image"><h5 class=author-name>Mark Gascoyne</h5><p class=text-muted>Tuesday, February 25, 2025 | 6 minutes</p></div><div class=title><h1>Practical GitOps Pattern</h1></div><div class=tags><ul style=padding-left:0></ul></div><div class=post-content id=post-content><p><strong>Introduction</strong><br>If you’ve spent any time working with Kubernetes, you’ve probably heard of <em>GitOps</em> -a methodology that treats Git as the source of truth for defining and operating infrastructure and applications. In this post, I’ll walk you through a GitOps setup that uses a hierarchical folder structure, combining Helm, Helmfile, and Kustomize to give you robust, testable, and scalable deployments. We’ll also see how tools like Flux and Tilt fit into the workflow, enabling both automated deployments and seamless local development.</p><hr><h2 id=why-gitops><strong>Why GitOps?</strong></h2><p>Before we dive into the specifics, let’s revisit what GitOps brings to the table:</p><ul><li><strong>Version Control</strong>: Every change to your Kubernetes configurations is committed to Git, providing an audit trail and easy rollbacks.</li><li><strong>Single Source of Truth</strong>: Teams can rely on the repo as the canonical description of what’s running in each cluster.</li><li><strong>Automation</strong>: Changes in Git trigger updates to your clusters, reducing manual operations and ensuring consistency.</li></ul><p>This post assumes you&rsquo;re already sold on GitOps and are looking for a tangible organisational pattern. Let&rsquo;s jump in.</p><hr><h2 id=the-repository-structure><strong>The Repository Structure</strong></h2><p>Our GitOps repository is divided into <strong>four main folders</strong> -plus a special <code>src</code> directory for source code and a <code>Tiltfile</code> for local dev. Here’s a quick overview:</p><pre tabindex=0><code>.
├── helm-charts  
├── components  
├── groups 
├── clusters
├── src
└── Tiltfile
</code></pre><h3 id=1-helm-charts><strong>1. Helm Charts</strong></h3><ul><li><strong>Purpose</strong>: This directory stores all Helm charts -whether first-party or third-party dependencies -that form the foundation of your Kubernetes services.</li><li><strong>Workflow</strong>:<ol><li><strong>Render</strong>: Helm charts are templated to disk.</li><li><strong>Include in Kustomize</strong>: You use Kustomize to ingest those templates.</li><li><strong>Manage with Helmfile</strong>: Helmfile can orchestrate multiple Helm releases, ensuring everything is installed/updated consistently.</li></ol></li></ul><p>This approach decouples the raw Helm charts from the environment-specific overlays, making it easier to plug them into different clusters in a standardized way.</p><h3 id=2-components><strong>2. Components</strong></h3><ul><li><strong>Purpose</strong>: Store Kubernetes manifests that are <em>not</em> part of Helm charts.<ul><li>This could include CRDs (Custom Resource Definitions), operator manifests, or any other resources you want to keep separate.</li></ul></li><li><strong>Usage</strong>: Directly reference these components in your cluster definitions or in a higher-level grouping concept (more on that next).</li></ul><h3 id=3-groups><strong>3. Groups</strong></h3><ul><li><strong>Purpose</strong>: Group related services and configurations together under a single overlay.<ul><li>For example, a <code>monitoring</code> group might include Prometheus, Grafana, and other supporting components.</li></ul></li><li><strong>Hierarchy</strong>:<ul><li>Groups can reference other groups, enabling layering.</li><li>A <code>dev</code> group might inherit from a <code>default</code> group, adding environment-specific patches for development clusters (e.g., less resource allocation, debug logging).</li></ul></li></ul><h3 id=4-clusters><strong>4. Clusters</strong></h3><ul><li><strong>Purpose</strong>: Each cluster folder describes exactly <em>what</em> should be running on that cluster, pulling in components and groups as needed.</li><li><strong>Structure</strong>:<ul><li>Each cluster has its own folder, which Flux (or another GitOps tool like Argo CD) monitors.</li><li>Subfolders often map to namespaces or functional areas.</li><li>Environment-specific customisations, such as image overrides or domain-specific settings, also live here.</li></ul></li><li><strong>Benefits</strong>: This design ensures that each cluster references only the resources it needs, with any environment-specific overrides captured in a single place.</li></ul><h3 id=5-src-git-submodules><strong>5. <code>src</code> (Git Submodules)</strong></h3><ul><li><strong>Purpose</strong>: Each application or service your team develops has its own dedicated repo, added to this GitOps repo as a submodule.</li><li><strong>Motivation</strong>: Separating source code lifecycles from infrastructure while still keeping them in close proximity.<ul><li>Each service can evolve at its own pace (with separate versioning and pull requests).</li><li>When you’re ready to deploy, you update references in the GitOps repo to point to the correct version or commit.</li></ul></li></ul><h3 id=6-tilt-for-local-development><strong>6. Tilt for Local Development</strong></h3><ul><li><strong>Tiltfile</strong>: A single <code>Tiltfile</code> at the root of your GitOps repo configures local Kubernetes development using <a href=https://tilt.dev/ target=_blank rel=noopener>Tilt</a> and <a href=https://k3d.io/ target=_blank rel=noopener>k3d</a>.</li><li><strong>Realtime Feedback</strong>:<ol><li>Tilt builds Docker images locally as you code and pushes them into your <code>k3d</code> cluster.</li><li>You can check out feature branches across multiple submodules and test them all together in a local environment.</li></ol></li><li><strong>Developer Happiness</strong>: This local dev approach drastically shortens the feedback loop, letting you iterate faster than if you had to push and wait for a remote pipeline to run.</li></ul><hr><h2 id=cicd-flow><strong>CI/CD Flow</strong></h2><p>Now that we’ve broken down the structure, let’s see how changes flow from a developer’s pull request to a cluster.</p><h3 id=1-pull-request--image-build><strong>1. Pull Request → Image Build</strong></h3><ul><li><strong>Trigger</strong>: A developer creates or updates a pull request in the <code>src</code> project repository.</li><li><strong>Automation</strong>: A CI pipeline (e.g., GitHub Actions, Jenkins, GitLab CI) builds a Docker image for the new code.</li></ul><h3 id=2-ci-environment-setup-in-dev-cluster><strong>2. CI Environment Setup in Dev Cluster</strong></h3><ul><li>The pipeline references the GitOps repo (specifically the <strong>Dev cluster folder</strong>).</li><li>A <strong>CI folder</strong> under that Dev cluster is used to stand up a temporary environment for tests.<ul><li>This CI folder typically isn’t referenced by the main Dev cluster overlay, so it doesn’t affect production-like resources.</li></ul></li><li>The pipeline applies a Kustomization overlay that includes the new Docker image (and possibly “latest” versions of other services).</li></ul><h3 id=3-readiness--integration-tests><strong>3. Readiness & Integration Tests</strong></h3><ol><li><strong>Wait for Ready</strong>: The pipeline checks that all pods in the CI environment reach a “Ready” state.</li><li><strong>Integration Tests</strong>:<ul><li>Another folder within the CI path (e.g., <code>integration-test</code>) includes job manifests that run your test suite.</li><li>The pipeline applies these manifests, waits for the jobs to complete, then collects logs/results.</li></ul></li></ol><h3 id=4-cleanup><strong>4. Cleanup</strong></h3><ul><li>Once tests finish, the pipeline tears down the temporary namespace to keep clusters clean.</li><li>If tests pass, the pipeline can merge the pull request or notify that the new image is ready for promotion.</li></ul><hr><h2 id=key-benefits><strong>Key Benefits</strong></h2><ol><li><strong>Modular & Extensible</strong>: By separating Helm charts, components, groups, and clusters, you can easily add new resources or reuse existing ones.</li><li><strong>Consistent Environments</strong>: Groups let you define and share sets of configurations across multiple stages (e.g., dev, staging, prod).</li><li><strong>Automated Testing</strong>: The CI process ensures each new feature or fix is validated in an ephemeral environment, mirroring production as closely as you need.</li><li><strong>Local Development</strong>: Tilt and k3d let you replicate the cluster environment on your machine, enabling quicker feedback loops and more productive debugging.</li><li><strong>Auditability & Traceability</strong>: Since every change is committed to Git, you get a clear history of who changed what and when.</li></ol><hr><h2 id=the-single-pane-of-glass><strong>The Single Pane of Glass</strong></h2><p>Beyond the technical benefits, this pattern fundamentally changes how teams collaborate.</p><p><strong>One entry point, any role.</strong> Whether you&rsquo;re a backend engineer, frontend dev, SRE, or even a PM wanting to understand the system - you clone one repo and run <code>tilt up</code>. Within minutes you have a working <code>https://localhost.company.co/</code> with the entire stack running locally.</p><p><strong>Cross-functional debugging.</strong> I&rsquo;ve watched frontend engineers fix backend bugs by running <code>grep -r "error message"</code> from the repo root. The pseudo mono-repo structure means the answer is always <em>somewhere</em> in your checkout - you just need to find it.</p><p><strong>No onboarding tax.</strong> Switching teams doesn&rsquo;t mean spending a week setting up a new development environment. The same <code>tilt up</code> command works whether you&rsquo;re on payments, auth, or the data pipeline.</p><p><strong>Declarative infrastructure as documentation.</strong> New joiners can understand the entire system topology by reading the <code>clusters/</code> and <code>groups/</code> directories. The infrastructure <em>is</em> the documentation.</p><hr><h2 id=conclusion><strong>Conclusion</strong></h2><p>Adopting GitOps with a well-thought-out repository structure can dramatically simplify your Kubernetes workflows. By combining Helm, Helmfile, Kustomize, and tools like Flux or Argo CD, you can create modular, scalable, and testable deployments. And with a local development pipeline powered by Tilt and k3d, you can iterate quickly without sacrificing best practices.</p><p>If you’re looking for a GitOps pattern that balances clarity, flexibility, and collaboration, give this structure a try. You’ll enjoy:</p><ul><li>Fewer manual steps.</li><li>A predictable CI process.</li><li>An environment that’s friendly for both new and experienced team members.</li></ul><p><strong>Ready to dive deeper?</strong> Experiment with a small cluster or side project first. Once you’re comfortable with the structure, scale it up to your full production workloads. Happy deploying!</p><hr><p><strong>Further Reading</strong></p><ul><li><a href=https://fluxcd.io/ target=_blank rel=noopener>Flux CD</a></li><li><a href=https://helm.sh/ target=_blank rel=noopener>Helm</a></li><li><a href=https://kustomize.io/ target=_blank rel=noopener>Kustomize</a></li><li><a href=https://tilt.dev/ target=_blank rel=noopener>Tilt</a></li><li><a href=https://k3d.io/ target=_blank rel=noopener>k3d Docs</a></li></ul></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn icon-button bg-facebook" href="https://www.facebook.com/sharer.php?u=%2fposts%2fgitops%2f" target=_blank><i class="fab fa-facebook"></i>
</a><a class="btn icon-button bg-twitter" href="https://twitter.com/share?url=%2fposts%2fgitops%2f&text=Practical%20GitOps%20Pattern&via=Marks%20Blog" target=_blank><i class="fab fa-twitter"></i>
</a><a class="btn icon-button bg-reddit" href="https://reddit.com/submit?url=%2fposts%2fgitops%2f&title=Practical%20GitOps%20Pattern" target=_blank><i class="fab fa-reddit"></i>
</a><a class="btn icon-button bg-linkedin" href="https://www.linkedin.com/shareArticle?url=%2fposts%2fgitops%2f&title=Practical%20GitOps%20Pattern" target=_blank><i class="fab fa-linkedin"></i>
</a><a class="btn icon-button bg-whatsapp" href="https://api.whatsapp.com/send?text=Practical%20GitOps%20Pattern %2fposts%2fgitops%2f" target=_blank><i class="fab fa-whatsapp"></i>
</a><a class="btn icon-button" href="mailto:?subject=Practical%20GitOps%20Pattern&body=%2fposts%2fgitops%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/ebpf-bng/ title="Killing the ISP Appliance: An eBPF/XDP Approach to Distributed BNG" class="btn filled-button"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>Killing the ISP Appliance: An eBPF/XDP Approach to Distributed BNG</div></a></div><div class="col-md-6 next-article"><a href=/posts/socat/ title="Using socat to backdoor via kubernetes" class="btn filled-button"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Using socat to backdoor via kubernetes</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#why-gitops><strong>Why GitOps?</strong></a></li><li><a href=#the-repository-structure><strong>The Repository Structure</strong></a><ul><li><a href=#1-helm-charts><strong>1. Helm Charts</strong></a></li><li><a href=#2-components><strong>2. Components</strong></a></li><li><a href=#3-groups><strong>3. Groups</strong></a></li><li><a href=#4-clusters><strong>4. Clusters</strong></a></li><li><a href=#5-src-git-submodules><strong>5. <code>src</code> (Git Submodules)</strong></a></li><li><a href=#6-tilt-for-local-development><strong>6. Tilt for Local Development</strong></a></li></ul></li><li><a href=#cicd-flow><strong>CI/CD Flow</strong></a><ul><li><a href=#1-pull-request--image-build><strong>1. Pull Request → Image Build</strong></a></li><li><a href=#2-ci-environment-setup-in-dev-cluster><strong>2. CI Environment Setup in Dev Cluster</strong></a></li><li><a href=#3-readiness--integration-tests><strong>3. Readiness & Integration Tests</strong></a></li><li><a href=#4-cleanup><strong>4. Cleanup</strong></a></li></ul></li><li><a href=#key-benefits><strong>Key Benefits</strong></a></li><li><a href=#the-single-pane-of-glass><strong>The Single Pane of Glass</strong></a></li><li><a href=#conclusion><strong>Conclusion</strong></a></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=/#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=/#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:contact@markgascoyne.co.uk target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>contact@markgascoyne.co.uk</span></a></li><li><span>Location: </span><span>United Kingdom</span></li><li><a href=tel:+44%207951553010 target=_blank rel=noopener><span><i class="fas fa-phone-alt"></i></span> <span>+44 7951553010</span></a></li></ul></div></div></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu_b3360284c55cf72d.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2020 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.13bc872e6738e7032ba913080be67184a0bc5cb6b8def26d338d9970e2e1f127.js integrity="sha256-E7yHLmc45wMrqRMIC+ZxhKC8XLa43vJtM42ZcOLh8Sc=" defer></script></body></html>